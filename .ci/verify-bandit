#! /usr/bin/env bash

set -e
set -o pipefail

SOURCE_PATH=${SOURCE_PATH:-}
export VENV_BIN

if [[ -z ${SOURCE_PATH} ]]; then
    SOURCE_PATH="$(readlink -f "$(dirname "${0}")"/..)"
fi
cd "${SOURCE_PATH}" || exit 1

if [ "${DESTINATION}" == "" ]; then
    "${VENV_BIN}/bandit" --format sarif -r src hacks/ghelp
    exit
fi

"${VENV_BIN}/bandit" --format sarif -r src hacks/ghelp | tee "${DESTINATION}"

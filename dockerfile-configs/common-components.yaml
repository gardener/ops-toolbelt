# Copyright 2019 Copyright (c) 2019 SAP SE or an SAP affiliate company. All rights reserved. This file is licensed under the Apache Software License, v. 2 except as noted otherwise in the LICENSE file.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

- apt-get:
  - curl
  - git
  - tree
  - htop
  - less
  - vim
  - tmux
  - bash-completion
  - python3-distutils
  - dstat
  - ngrep
  - jq
  - figlet
  - tcpdump
  - name: silversearcher-ag
    provides: ag
  - name: iproute2
    provides: ip
  - name: dnsutils
    provides: ["delv", "dig", "mdig", "nslookup", "nsupdate"]
  - name: netcat-openbsd
    provides: netcat
  - name: python3-minimal
    provides: python3

- curl:
  - name: yaml2json
    version: v1.3
    from: https://github.com/bronze1man/yaml2json/releases/download/{version}/yaml2json_linux_amd64
    info: transform yaml string to json string without the type infomation.
  - name: kubectl
    version: v1.17.1
    from: https://storage.googleapis.com/kubernetes-release/release/{version}/bin/linux/amd64/kubectl
    info: command line tool for controlling Kubernetes clusters. "kubectl krew install plunin_name" to install plugin. "kubectl get-all -n namespace" to list all resources in namespaces.
  - name: pip
    from: https://bootstrap.pypa.io/get-pip.py
    to: /get-pip.py
    command: |
      python3 /get-pip.py;\
      rm /get-pip.py
    info: ~
  - name: cat
    version: v1.1.0
    from: https://github.com/jingweno/ccat/releases/download/{version}/linux-amd64-1.1.0.tar.gz
    to: /ccat.tar.gz
    command: |
      tar -zxf ccat.tar.gz linux-amd64-1.1.0/ccat &&\
      mv linux-amd64-1.1.0/ccat /bin/cat &&\
      rm -rf linux-amd64-1.1.0 ccat.tar.gz &&\
      chmod 755 /bin/cat
    info: The colorizing cat. It works similar to cat but displays content with syntax highlighting.

- bash:
  - name: generate_locale
    command: |
      apt-get --yes update && apt-get install --yes locales ;\
      locale-gen "en_US.UTF-8"
    info: ~

- env:
  - LANG=en_US.UTF-8
  - LANGUAGE=en_US.UTF-8

- pip:
  - mdv
  - tabulate

- copy:
  - name: dotfiles
    from: ./dotfiles
    to: /root/dotfiles
    info: ~
  - name: hacks
    from: ./hacks
    to: /hacks
    info: ~

- bash:
  - name: bash-completion
    command: |
      echo "" >> /root/.bashrc;\
      echo "source /etc/profile.d/bash_completion.sh" >> /root/.bashrc
    info: ~
  - name: dotfiles
    command: |
      echo "" >> /root/.bashrc;\
      echo "# source bashrc from dotfiles" >> /root/.bashrc;\
      echo "source /root/dotfiles/.bashrc" >> /root/.bashrc;\
      touch /root/dotfiles/.config/git/config_personal
    info: |
      The sourced dotfiles are located under /root/dotfiles.\n\
      Additionally you can add your own personal git settings in /root/dotfiles/.config/git/config_personal\n\
  - name: hacks
    command: |
      echo "export PATH=/hacks:\$PATH" >> /root/.bashrc
    info: ~
  - name: krew
    command: |
      set -x; cd "$(mktemp -d)";\
      curl -fsSLO "https://github.com/kubernetes-sigs/krew/releases/latest/download/krew.{tar.gz,yaml}";\
      tar zxvf krew.tar.gz;\
      KREW=./krew-"$(uname | tr '[:upper:]' '[:lower:]')_amd64";\
      "$KREW" install --manifest=krew.yaml --archive=krew.tar.gz;\
      "$KREW" update;\
      export PATH="${KREW_ROOT:-$HOME/.krew}/bin:$PATH";\
      echo "export PATH=~/.krew/bin:\$PATH" >>/root/.bashrc
    info: |
      krew is plugin manager for kubectl, see https://github.com/kubernetes-sigs/krew
  - name: ketall
    command: |
      kubectl krew install get-all
    info: |
      ketall is to enable `kubectl get-all -n namespace_name`, for listing all resources in some namespace
  - name:  crictl
    command: |
      cd /root/dotfiles/;\
      chmod +x install_crictl.sh;\
      ./install_crictl.sh
    info: |
      crictl is cli tools for Kubelet Container Runtime Interface (CRI).


- env:
  - DOTFILES_USER=root
  - DOTFILES_HOME=/root/dotfiles



